<?xml version="1.0" encoding="iso-8859-1"?>
<root version="3.0" release="1">

	<announcement text="Mob Attack Automator (C) 2025 mlheur@gmail.com" font="emotefont" icon="MAA_icon" />

	<properties>
		<name>mob-attack-automator</name>
		<version>1</version>
		<author>mlheur</author>
		<description>Automate mobs of critters, or squads of archers, all attacking a single target.</description>
		<ruleset><name>5E</name></ruleset>
		<loadorder>125</loadorder>
	</properties>

	<base>

		<icon name="MAA_icon" file="graphics/buttons/button_roll.png" />

        <script name="MAA" file="scripts/MAA.lua" />

        <string name="MAA_window_title">Mob Attack Automator</string>

        <windowclass name="MAA">
            <frame>utilitybox</frame>
            <placement><size width="480" height="400" /></placement>
            <sizelimits>
                <minimum width="480" height="400" />
            </sizelimits>
			<sheetdata>
				<windowtitlebar_utilitybox name="title" />
				<windowmenubar_utilitybox name="menubar" />
				<anchor_content_utilitybox_top />
				<anchor_content_utilitybox_bottom />
				<subwindow name="MAA_attacker">
					<class>MAA_attacker</class>
					<anchored to="contentanchor" position="belowleft">
						<size width="100" height="100" />
					</anchored>
					<activate />
					<script>
						function onInit()
							MAA.dbg("++MAA_attacker:onInit()")
							local nodeActive = CombatManager.getActiveCT();
							if nodeActive == nil then
								MAA.dbg("--MAA_attacker:onInit() FAILED: nodeActive is nil")
								return
							end
							setValue("MAA_attacker", nodeActive)
							MAA.dbg("--MAA_attacker:onInit()")
						end
					</script>
				</subwindow>
				<subwindow name="MAA_target">
					<class>MAA_target</class>
					<anchored to="contentanchor" position="belowright">
						<size width="100" height="100" />
					</anchored>
					<activate />
					<script>
						function onInit()
							MAA.dbg("++MAA_target:onInit()")
							local nodeActive = CombatManager.getActiveCT();
							if nodeActive == nil then
								MAA.dbg("--MAA_target:onInit() FAILED: nodeActive is nil")
								return
							end
							nodeActiveTargetting = nodeActive.getChild("targets")
							if nodeActiveTargetting == nil then
								MAA.dbg("--MAA_target:onInit() FAILED: nodeActiveTargetting is nil")
								return
							end
							nodeRefActiveTargetting = nil
							for nodname,dbnode in pairs(nodeActiveTargetting.getChildren()) do
								nodeRefActiveTargetting = dbnode
								break
							end
							if nodeRefActiveTargetting == nil then
								MAA.dbg("--MAA_target:onInit() FAILED: nodeRefActiveTargetting is nil")
								return
							end
							string_nodeOfTarget = nodeRefActiveTargetting.getChild("noderef").getValue()
							nodeTarget = DB.findNode(string_nodeOfTarget)
							setValue("MAA_target", nodeTarget)
							MAA.dbg("--MAA_target:onInit()")
						end
					</script>
				</subwindow>
			</sheetdata>

        </windowclass>

		<windowclass name="MAA_attacker" backcolor="red">
			<frame>groupbox</frame>
		</windowclass>

		<windowclass name="MAA_target" backcolor="blue">
			<frame>groupbox</frame>
		</windowclass>

	</base>

</root>